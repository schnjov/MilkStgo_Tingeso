<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Agregar Proveedor</title>
    <link th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}" rel="stylesheet" />
</head>
<body>
<script th:src="@{/webjars/jquery/3.6.4/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.min.js}"></script>
<div class="container mt-5 align-content-center">
    <h1>Agregar Proveedor</h1>
    <form id="proveedor-form" class="mt-4 block">
        <div class="form-group mt-3">
            <label for="codigo">Código</label>
            <input type="text" class="form-control" id="codigo" name="codigo" required>
        </div>
        <div class="form-group mt-3">
            <label for="nombre">Nombre</label>
            <input type="text" class="form-control" id="nombre" name="nombre" required>
        </div>
        <div class="form-group mt-3">
            <label for="categoria">Categoría</label>
            <input type="text" class="form-control" id="categoria" name="categoria" required>
        </div>
        <div class="form-group mt-3">
            <label for="afectoARetencion">¿Afecto a Retención?</label>
            <select class="form-control" id="afectoARetencion" name="afectoARetencion" required>
                <option value="true">Sí</option>
                <option value="false">No</option>
            </select>
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <a href="/" class="btn btn-light">Volver</a>
        </div>

    </form>
</div>

<script>
    $(function() {
        $("#proveedor-form").submit(function(event) {
            event.preventDefault(); // Evita que se envíe la solicitud HTTP POST por defecto del formulario.

            var form = $(this); // Obtiene el formulario.
            var url = "http://localhost:8090/proveedor/save"; // Setea la URL de la solicitud.
            var data = form.serializeArray(); // Serializa los datos del formulario en formato de arreglo.

            var proveedor = {}; // Crea un objeto vacío para el proveedor.
            $.each(data, function() {
                proveedor[this.name] = this.value; // Asigna las propiedades del objeto con los valores del formulario.
            });
            var json = JSON.stringify(proveedor); // Convierte el objeto en formato JSON.

            $.ajax({
                type: "POST",
                url: url,
                contentType: "application/json", // Establece el tipo de contenido como JSON.
                data: json, // Establece el cuerpo de la solicitud con el objeto JSON.
                success: function(result) {
                    alert("Proveedor guardado exitosamente.");
                    window.location.href = "/proveedores/listar"; // Redirecciona a la página que muestra todos los proveedores.
                },
                error: function(xhr) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    alert("Error al guardar el proveedor: " + errorMessage);

                }
            });
        });
    });
</script>
</body>
</html>